{panaedra/msroot/msutil/logic/top_i/ctop_class.i} 

class panaedra.msroot.msutil.logic.sc_string_substitute: 

  /******************************  Dvcs_ Header ********************************\
         Filename: $Archive:  $ 
          Version: $Revision:  $ 
       Programmer: $Author: $ 
     Date Checkin: $Date:  $ 
    Date Modified: $Modtime:  $ 

      Description: String substitution, for example os-environment vars inside strings

  \*****************************  Include Files ********************************/

  /************************  Source control constructor ************************/
  constructor public sc_string_substitute(o-sourcecontrol as panaedra.msroot.msv.logic.c_sourcecontrol, o-inheritant as Progress.Lang.Object):
    /* Uncomment when inheriting: super(o-sourcecontrol, this-object).*/
    panaedra.msroot.msv.logic.c_sourcecontrol:Construct_SRVR_ll(o-sourcecontrol, this-object, o-inheritant, '$Revision: $', '{&sourcecontrolversions}').
  end constructor.
  /******************************* $NoKeywords:  $ *****************************/


  method public static character ExpandOsEnv
    
    /* This method first tries explicit unix syntax. 
       Example: "sometext$往轴蟒犷浃往渝泔钿轴蟒祜蝓黹痼蹴涉躅轼簌铘狲轶铒骘躅洮ア鏖钿秣篝犷溽蜾狎趄殄洚ㄣ深瘐羯校狍汨狎徙翦颟溴骈铄鲠蜷徕戾樯钿屮狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾樯钿屮郁狎簦狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾樯钿屮蓬洌狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾榕钿狍轭翦珏铒躅滹溴骈铄鲠蜷徕戾阆笈铞狍汨狎徙翦铒躅滹樯钿屮轭溴ㄣ深瘐羯校ГЗ殒樯钿屮翳孱滹滹麒殪樯钿屮昂狍箝珙榕钿轭溴ㄣ深瘐羯校', iIndex#)
          cOsEnv# = os-getenv(substring(cInputIP#, iIndex# + 2, iEnd# - iIndex# - 2)).
        
        if cOsEnv# = ? then 
          cOsEnv# = substring(cInputIP#, iIndex# + 2, iEnd# - iIndex# - 2).
        
        substring(cInputIP#, iIndex#, iEnd# - iIndex# + 1) = cOsEnv#.
      
        iIndex# = index(cInputIP#,'$').
      
      end.
    
    end. /* dollar sign found */
    else 
    do:
      
      iIndexStart# = index(cInputIP#,'%').
      
      if iIndexStart# > 0 then
      b_search_dollar: 
      do:
        
        do while iIndexStart# > 0:
          
          iIndexEnd# = index(cInputIP#,'%',iIndexStart# + 1).
          
          if iIndexEnd# = 0 then leave b_search_dollar.
          
          else 
          do:
            
            cOsEnv# = os-getenv(substring(cInputIP#, iIndexStart# + 1, iIndexEnd# - iIndexStart# - 1)).

            if cOsEnv# > "" then 
              substring(cInputIP#, iIndexStart#, iIndexEnd# - iIndexStart# + 1) = cOsEnv#.
            
            assign
              iIndexStart# = index(cInputIP#,'%',iIndexEnd# + 1).
              iIndexEnd#   = 0.
          end.
          
        end.
        
      end.
      
    end.
    
    return cInputIP#.
  
  end method. /* ExpandOsEnv */

end class.

/* EOF */ 
